!function(t,i){"use strict";"function"==typeof define&&define.amd?define(["classie/classie","eventie/eventie","./flickity","unidragger/unidragger","fizzy-ui-utils/utils"],function(e,s,n,r,o){return i(t,e,s,n,r,o)}):"object"==typeof exports?module.exports=i(t,require("desandro-classie"),require("eventie"),require("./flickity"),require("unidragger"),require("fizzy-ui-utils")):(t.Flickity=t.Flickity||{},t.Flickity.dragPrototype=i(t,t.classie,t.eventie,t.Flickity,t.Unidragger,t.fizzyUIUtils))}(window,function(t,i,e,s,n,r){"use strict";function o(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function a(i){var e=n.getPointerPoint(i);return e.y-t.pageYOffset}r.extend(s.defaults,{draggable:!0,touchVerticalScroll:!0}),s.createMethods.push("_createDrag");var h={};r.extend(h,n.prototype),h._createDrag=function(){this.on("activate",this.bindDrag),this.on("uiChange",this._uiChangeDrag),this.on("childUIPointerDown",this._childUIPointerDownDrag),this.on("deactivate",this.unbindDrag)},h.bindDrag=function(){this.options.draggable&&!this.isDragBound&&(i.add(this.element,"is-draggable"),this.handles=[this.viewport],this.bindHandles(),this.isDragBound=!0)},h.unbindDrag=function(){this.isDragBound&&(i.remove(this.element,"is-draggable"),this.unbindHandles(),delete this.isDragBound)},h.hasDragStarted=function(t){return Math.abs(t.x)>3},h._uiChangeDrag=function(){delete this.isFreeScrolling},h._childUIPointerDownDrag=function(t){o(t),this.pointerDownFocus(t)},h.pointerDown=function(t,e){this._dragPointerDown(t,e);var s=document.activeElement;s&&s.blur&&s!=this.element&&s.blur(),this.pointerDownFocus(t),this.velocity=0,i.add(this.viewport,"is-pointer-down"),this._bindPostStartEvents(t),this.dispatchEvent("pointerDown",t,[e])};var l={touchstart:!0,MSPointerDown:!0},c={INPUT:!0,SELECT:!0};h.pointerDownFocus=function(t){!this.options.accessibility||l[t.type]||c[t.target.nodeName]||this.element.focus()},h.pointerMove=function(t,i){var e=this._dragPointerMove(t,i);this.touchVerticalScrollMove(t,i,e),this._dragMove(t,i,e),this.dispatchEvent("pointerMove",t,[i,e])},h.pointerUp=function(t,e){delete this.isTouchScrolling,i.remove(this.viewport,"is-pointer-down"),this.dispatchEvent("pointerUp",t,[e]),this._dragPointerUp(t,e)};var d={touchmove:!0,MSPointerMove:!0};return h.touchVerticalScrollMove=function(i,e,s){if(this.options.touchVerticalScroll&&d[i.type]&&(!this.isTouchScrolling&&Math.abs(s.y)>16&&(this.startScrollY=t.pageYOffset,this.pointerWindowStartY=a(e),this.isTouchScrolling=!0),this.isTouchScrolling)){var n=this.pointerWindowStartY-a(e),r=this.startScrollY+n;t.scroll(t.pageXOffset,r)}},h.dragStart=function(t,i){this.dragStartPosition=this.x,this.startAnimation(),this.dispatchEvent("dragStart",t,[i])},h.dragMove=function(t,i,e){this.previousDragX=this.x;var s=e.x,n=this.options.rightToLeft?-1:1;if(this.x=this.dragStartPosition+s*n,!this.options.wrapAround&&this.cells.length){var r=Math.max(-this.cells[0].target,this.dragStartPosition);this.x=this.x>r?.5*(this.x-r)+r:this.x;var o=Math.min(-this.getLastCell().target,this.dragStartPosition);this.x=this.x<o?.5*(this.x-o)+o:this.x}this.previousDragMoveTime=this.dragMoveTime,this.dragMoveTime=new Date,this.dispatchEvent("dragMove",t,[i,e])},h.dragEnd=function(t,i){this.dragEndFlick(),this.options.freeScroll&&(this.isFreeScrolling=!0);var e=this.dragEndRestingSelect();if(this.options.freeScroll&&!this.options.wrapAround){var s=this.getRestingPosition();this.isFreeScrolling=-s>this.cells[0].target&&-s<this.getLastCell().target}else this.options.freeScroll||e!=this.selectedIndex||(e+=this.dragEndBoostSelect());this.select(e),this.dispatchEvent("dragEnd",t,[i])},h.dragEndFlick=function(){if(isFinite(this.previousDragX)){var t=this.dragMoveTime-this.previousDragMoveTime;if(t){t/=1e3/60;var i=this.x-this.previousDragX;this.velocity=i/t}delete this.previousDragX}},h.dragEndRestingSelect=function(){var t=this.getRestingPosition(),i=Math.abs(this.getCellDistance(-t,this.selectedIndex)),e=this._getClosestResting(t,i,1),s=this._getClosestResting(t,i,-1),n=e.distance<s.distance?e.index:s.index;return this.options.contain&&!this.options.wrapAround&&(n=Math.abs(n-this.selectedIndex)<=1?this.selectedIndex:n),n},h._getClosestResting=function(t,i,e){for(var s=this.selectedIndex,n=1/0,r=this.options.contain&&!this.options.wrapAround?function(t,i){return i>=t}:function(t,i){return i>t};r(i,n)&&(s+=e,n=i,i=this.getCellDistance(-t,s),null!==i);)i=Math.abs(i);return{distance:n,index:s-e}},h.getCellDistance=function(t,i){var e=this.cells.length,s=this.options.wrapAround&&e>1,n=s?r.modulo(i,e):i,o=this.cells[n];if(!o)return null;var a=s?this.slideableWidth*Math.floor(i/e):0;return t-(o.target+a)},h.dragEndBoostSelect=function(){var t=this.getCellDistance(-this.x,this.selectedIndex);return t>0&&this.velocity<-1?1:0>t&&this.velocity>1?-1:0},h.staticClick=function(t,i){var e=this.getParentCell(t.target),s=e&&e.element,n=e&&r.indexOf(this.cells,e);this.dispatchEvent("staticClick",t,[i,s,n])},r.extend(s.prototype,h),s});